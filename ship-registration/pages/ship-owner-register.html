<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل سفينة جديدة - نظام تسجيل السفن</title>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* ===== المتغيرات العامة ===== */
        :root {
            --primary: #1e4b7a;
            --primary-dark: #0f2c4a;
            --primary-light: #2c7be5;
            --secondary: #8b7355;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --white: #ffffff;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Arabic', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e6eef5 100%);
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ===== شريط التنقل ===== */
        .navbar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 16px 32px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .navbar-brand i {
            font-size: 1.8rem;
        }

        .navbar-brand h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-light {
            background: white;
            color: var(--primary);
        }

        .btn-light:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #1e7e34);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e0a800);
            color: white;
        }

        /* ===== تقدم التسجيل ===== */
        .progress-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 30px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 20px;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: #e2e8f0;
            z-index: 1;
        }

        .step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }

        .step-icon {
            width: 50px;
            height: 50px;
            background: white;
            border: 3px solid #e2e8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: #94a3b8;
            font-size: 1.2rem;
        }

        .step.active .step-icon {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .step.completed .step-icon {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }

        .step-title {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .step-desc {
            font-size: 0.85rem;
            color: #64748b;
        }

        /* ===== بطاقة النموذج ===== */
        .form-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .card-header h2 {
            color: var(--primary);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ===== نموذج الإدخال ===== */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group label i {
            color: var(--primary);
            margin-left: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 75, 122, 0.1);
        }

        .form-control.error {
            border-color: var(--danger);
            background: rgba(220, 53, 69, 0.05);
        }

        .error-message {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 5px;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 15px center;
            padding-left: 45px;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        /* ===== رفع الملفات ===== */
        .file-upload-area {
            border: 2px dashed #e2e8f0;
            border-radius: var(--radius-md);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(30, 75, 122, 0.05);
        }

        .file-upload-area i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .file-upload-area h4 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        .file-upload-area p {
            color: #64748b;
            font-size: 0.9rem;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: #f8fafc;
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-info i {
            color: var(--primary);
        }

        .file-remove {
            color: var(--danger);
            cursor: pointer;
        }

        /* ===== أضواء التحقق ===== */
        .validation-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .validation-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .validation-dot.valid {
            background: var(--success);
        }

        .validation-dot.invalid {
            background: var(--danger);
        }

        /* ===== بطاقة المعلومات ===== */
        .info-card {
            background: #f0f9ff;
            border-right: 4px solid var(--primary);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 30px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .info-icon {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .info-content h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .info-content p {
            color: #64748b;
        }

        /* ===== جدول المحركات ===== */
        .engines-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .engines-table th {
            background: linear-gradient(135deg, rgba(30, 75, 122, 0.05), rgba(15, 44, 74, 0.05));
            color: var(--primary);
            padding: 12px;
            text-align: right;
            font-weight: 700;
        }

        .engines-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .add-engine-btn {
            background: rgba(30, 75, 122, 0.1);
            color: var(--primary);
            border: 1px dashed var(--primary);
            padding: 10px;
            width: 100%;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-engine-btn:hover {
            background: rgba(30, 75, 122, 0.2);
        }

        /* ===== أزرار التنقل ===== */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        /* ===== التحميل ===== */
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--primary);
        }

        .loading i {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        /* ===== التجاوب ===== */
        @media (max-width: 768px) {
            .progress-steps {
                flex-direction: column;
                gap: 20px;
            }
            
            .progress-steps::before {
                display: none;
            }
            
            .step {
                display: flex;
                align-items: center;
                text-align: right;
                gap: 20px;
            }
            
            .step-icon {
                margin: 0;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
        }

        /* ===== الإشعارات المنبثقة ===== */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: var(--dark);
            padding: 16px 24px;
            border-radius: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 9999;
            animation: slideDown 0.3s ease;
            border-right: 4px solid var(--primary);
        }

        .toast.success {
            border-right-color: var(--success);
        }

        .toast.error {
            border-right-color: var(--danger);
        }

        .toast.warning {
            border-right-color: var(--warning);
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translate(-50%, 0); opacity: 1; }
            to { transform: translate(-50%, -100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- شريط التنقل -->
        <nav class="navbar">
            <div class="navbar-brand">
                <i class="fas fa-ship"></i>
                <h1>نظام تسجيل السفن</h1>
            </div>
            <div>
                <span id="userName" style="margin-left: 15px;">
                    <i class="fas fa-user"></i> <span id="ownerName">جاري التحميل...</span>
                </span>
                <button class="btn btn-light" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                </button>
            </div>
        </nav>

        <!-- منطقة التحميل -->
        <div id="loadingIndicator" class="loading" style="display: none;">
            <i class="fas fa-circle-notch fa-spin"></i>
            <h3>جاري معالجة الطلب...</h3>
        </div>

        <!-- محتوى الصفحة -->
        <div id="registrationContent">
            <!-- شريط التقدم -->
            <div class="progress-section">
                <div class="progress-steps" id="progressSteps">
                    <div class="step active" id="step1">
                        <div class="step-icon">
                            <i class="fas fa-ship"></i>
                        </div>
                        <div class="step-title">معلومات السفينة</div>
                        <div class="step-desc">البيانات الأساسية والفنية</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="step-title">المحركات</div>
                        <div class="step-desc">تفاصيل المحركات والمواصفات</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-icon">
                            <i class="fas fa-file"></i>
                        </div>
                        <div class="step-title">المستندات</div>
                        <div class="step-desc">رفع المستندات المطلوبة</div>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="step-title">المراجعة</div>
                        <div class="step-desc">مراجعة وتأكيد البيانات</div>
                    </div>
                </div>
            </div>

            <!-- بطاقة المعلومات -->
            <div class="info-card">
                <div class="info-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="info-content">
                    <h4>تعليمات هامة</h4>
                    <p>يرجى التأكد من صحة جميع البيانات قبل الإرسال. المستندات المطلوبة: صورة من سند الملكية، شهادة القياس، شهادة الفحص الفني، صورة هوية المالك، السجل التجاري (للسفن التجارية).</p>
                </div>
            </div>

            <!-- نموذج تسجيل السفينة -->
            <form id="shipRegistrationForm" onsubmit="event.preventDefault();">
                <!-- الخطوة 1: معلومات السفينة -->
                <div id="step1Section" class="form-card">
                    <div class="card-header">
                        <h2><i class="fas fa-ship"></i> معلومات السفينة</h2>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label><i class="fas fa-ship"></i> اسم السفينة (عربي) *</label>
                            <input type="text" id="shipNameAr" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-ship"></i> اسم السفينة (إنجليزي)</label>
                            <input type="text" id="shipNameEn" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-hashtag"></i> رقم IMO</label>
                            <input type="text" id="imoNumber" class="form-control" placeholder="IMO 1234567">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-radio"></i> نداء النداء (Call Sign)</label>
                            <input type="text" id="callSign" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-wifi"></i> رقم MMSI</label>
                            <input type="text" id="mmsi" class="form-control" maxlength="9">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-tag"></i> نوع السفينة *</label>
                            <select id="shipType" class="form-control" required>
                                <option value="">اختر نوع السفينة</option>
                                <option value="cargo">سفينة شحن</option>
                                <option value="tanker">ناقلة نفط</option>
                                <option value="container">سفينة حاويات</option>
                                <option value="passenger">سفينة ركاب</option>
                                <option value="fishing">سفينة صيد</option>
                                <option value="tug">قاطرة</option>
                                <option value="yacht">يخت</option>
                                <option value="dredger">كراكة</option>
                                <option value="research">سفينة أبحاث</option>
                                <option value="supply">سفينة إمداد</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-layer-group"></i> فئة السفينة</label>
                            <select id="shipCategory" class="form-control">
                                <option value="">اختر الفئة</option>
                                <option value="a">الفئة A</option>
                                <option value="b">الفئة B</option>
                                <option value="c">الفئة C</option>
                                <option value="d">الفئة D</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-anchor"></i> ميناء التسجيل *</label>
                            <select id="portOfRegistry" class="form-control" required>
                                <option value="">اختر الميناء</option>
                                <option value="aden">عدن</option>
                                <option value="mukalla">المكلا</option>
                                <option value="hodeidah">الحديدة</option>
                                <option value="salif">الصليف</option>
                                <option value="mocha">المخا</option>
                                <option value="socotra">سقطرى</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-flag"></i> علم السفينة</label>
                            <input type="text" id="flagState" class="form-control" value="اليمن">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-globe"></i> الجنسية</label>
                            <input type="text" id="nationality" class="form-control" value="يمني">
                        </div>
                    </div>

                    <h3 style="color: var(--primary); margin: 30px 0 20px;"><i class="fas fa-calculator"></i> المواصفات الفنية</h3>

                    <div class="form-grid">
                        <div class="form-group">
                            <label><i class="fas fa-weight-hanging"></i> الحمولة الإجمالية (GT) *</label>
                            <input type="number" id="grossTonnage" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-weight-hanging"></i> الحمولة الصافية (NT) *</label>
                            <input type="number" id="netTonnage" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-weight-hanging"></i> الوزن الساكن (DWT)</label>
                            <input type="number" id="deadweight" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-arrows-alt-h"></i> الطول الكلي (متر) *</label>
                            <input type="number" step="0.01" id="lengthOverall" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-arrows-alt-v"></i> العرض (متر) *</label>
                            <input type="number" step="0.01" id="beam" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-arrows-alt"></i> العمق (متر) *</label>
                            <input type="number" step="0.01" id="depth" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-water"></i> الغاطس (متر)</label>
                            <input type="number" step="0.01" id="draft" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-tachometer-alt"></i> السرعة (عقدة)</label>
                            <input type="number" step="0.1" id="speed" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-boxes"></i> سعة الحاويات (TEU)</label>
                            <input type="number" id="containerCapacity" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-users"></i> سعة الركاب</label>
                            <input type="number" id="passengerCapacity" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-users"></i> عدد أفراد الطاقم</label>
                            <input type="number" id="crewCapacity" class="form-control">
                        </div>
                    </div>

                    <h3 style="color: var(--primary); margin: 30px 0 20px;"><i class="fas fa-industry"></i> معلومات الصنع</h3>

                    <div class="form-grid">
                        <div class="form-group">
                            <label><i class="fas fa-calendar"></i> سنة الصنع *</label>
                            <input type="number" id="yearBuilt" class="form-control" min="1900" max="2026" required>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-building"></i> اسم الشركة الصانعة</label>
                            <input type="text" id="builderName" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-globe"></i> بلد الصنع</label>
                            <input type="text" id="buildingCountry" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-ship"></i> حوض بناء السفن</label>
                            <input type="text" id="shipyard" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-hashtag"></i> رقم الهيكل</label>
                            <input type="text" id="hullNumber" class="form-control">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-cube"></i> مادة الهيكل</label>
                            <select id="hullMaterial" class="form-control">
                                <option value="">اختر المادة</option>
                                <option value="steel">فولاذ</option>
                                <option value="aluminum">ألمنيوم</option>
                                <option value="fiberglass">فايبر جلاس</option>
                                <option value="wood">خشب</option>
                                <option value="composite">مركب</option>
                            </select>
                        </div>
                    </div>

                    <div class="navigation-buttons">
                        <div></div>
                        <button type="button" class="btn btn-primary" onclick="nextStep(2)">
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>

                <!-- الخطوة 2: معلومات المحركات -->
                <div id="step2Section" class="form-card" style="display: none;">
                    <div class="card-header">
                        <h2><i class="fas fa-cogs"></i> معلومات المحركات</h2>
                    </div>

                    <div id="enginesContainer">
                        <table class="engines-table" id="enginesTable">
                            <thead>
                                <tr>
                                    <th>رقم المحرك</th>
                                    <th>النوع</th>
                                    <th>الصانع</th>
                                    <th>الموديل</th>
                                    <th>القوة (حصان)</th>
                                    <th>سنة الصنع</th>
                                    <th>عدد الأسطوانات</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="enginesBody">
                                <!-- سيتم إضافة المحركات هنا -->
                            </tbody>
                        </table>
                    </div>

                    <button type="button" class="add-engine-btn" onclick="addEngineRow()">
                        <i class="fas fa-plus"></i> إضافة محرك آخر
                    </button>

                    <div class="form-group" style="margin-top: 20px;">
                        <label><i class="fas fa-tachometer-alt"></i> إجمالي القدرة الحصانية</label>
                        <input type="number" id="totalEnginePower" class="form-control" readonly>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-outline" onclick="prevStep(1)">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep(3)">
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>

                <!-- الخطوة 3: المستندات -->
                <div id="step3Section" class="form-card" style="display: none;">
                    <div class="card-header">
                        <h2><i class="fas fa-file"></i> المستندات المطلوبة</h2>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-file-certificate"></i> وثيقة ملكية السفينة *</label>
                        <div class="file-upload-area" onclick="document.getElementById('ownershipDoc').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h4>اضغط لرفع وثيقة الملكية</h4>
                            <p>PDF, JPG, PNG - حد أقصى 10MB</p>
                            <input type="file" id="ownershipDoc" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                        </div>
                        <div id="ownershipDocList" class="file-list"></div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-ruler"></i> شهادة القياس *</label>
                        <div class="file-upload-area" onclick="document.getElementById('measurementDoc').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h4>اضغط لرفع شهادة القياس</h4>
                            <p>PDF, JPG, PNG - حد أقصى 10MB</p>
                            <input type="file" id="measurementDoc" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                        </div>
                        <div id="measurementDocList" class="file-list"></div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-clipboard-check"></i> شهادة الفحص الفني *</label>
                        <div class="file-upload-area" onclick="document.getElementById('inspectionDoc').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h4>اضغط لرفع شهادة الفحص</h4>
                            <p>PDF, JPG, PNG - حد أقصى 10MB</p>
                            <input type="file" id="inspectionDoc" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                        </div>
                        <div id="inspectionDocList" class="file-list"></div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-id-card"></i> صورة هوية المالك *</label>
                        <div class="file-upload-area" onclick="document.getElementById('ownerIdDoc').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h4>اضغط لرفع صورة الهوية</h4>
                            <p>PDF, JPG, PNG - حد أقصى 10MB</p>
                            <input type="file" id="ownerIdDoc" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                        </div>
                        <div id="ownerIdDocList" class="file-list"></div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-building"></i> السجل التجاري (للسفن التجارية)</label>
                        <div class="file-upload-area" onclick="document.getElementById('commercialRegDoc').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h4>اضغط لرفع السجل التجاري</h4>
                            <p>PDF, JPG, PNG - حد أقصى 10MB</p>
                            <input type="file" id="commercialRegDoc" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                        </div>
                        <div id="commercialRegDocList" class="file-list"></div>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-outline" onclick="prevStep(2)">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep(4)">
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>

                <!-- الخطوة 4: المراجعة والتأكيد -->
                <div id="step4Section" class="form-card" style="display: none;">
                    <div class="card-header">
                        <h2><i class="fas fa-check-circle"></i> مراجعة البيانات</h2>
                    </div>

                    <div style="background: #f8fafc; padding: 20px; border-radius: var(--radius-md); margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">معلومات السفينة</h4>
                        <div id="reviewShipInfo" style="display: grid; grid-template-columns: 1fr 2fr; gap: 10px;"></div>
                    </div>

                    <div style="background: #f8fafc; padding: 20px; border-radius: var(--radius-md); margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">المحركات</h4>
                        <div id="reviewEnginesInfo"></div>
                    </div>

                    <div style="background: #f8fafc; padding: 20px; border-radius: var(--radius-md); margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">المستندات المرفقة</h4>
                        <div id="reviewDocumentsInfo"></div>
                    </div>

                    <div style="background: #f0f9ff; padding: 20px; border-radius: var(--radius-md); margin-bottom: 20px; border-right: 4px solid var(--warning);">
                        <h4 style="color: var(--warning); margin-bottom: 10px;"><i class="fas fa-exclamation-triangle"></i> إقرار وتعهد</h4>
                        <p style="color: #64748b;">أتعهد بأن جميع البيانات المقدمة صحيحة وكاملة، وأتحمل المسؤولية القانونية الكاملة عن صحة المعلومات والمستندات المرفقة.</p>
                        <div style="margin-top: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="declarationCheckbox">
                                <span>أقر بصحة البيانات وأتحمل المسؤولية</span>
                            </label>
                        </div>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-outline" onclick="prevStep(3)">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button type="button" class="btn btn-success" onclick="submitApplication()" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> تقديم الطلب
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ================================================
        // تهيئة Supabase
        // ================================================
        const SUPABASE_URL = 'https://your-project-id.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                autoRefreshToken: true,
                persistSession: true
            }
        });

        // ================================================
        // المتغيرات العامة
        // ================================================
        let currentUser = null;
        let engines = [];
        let uploadedFiles = {};

        // ================================================
        // تهيئة الصفحة
        // ================================================
        document.addEventListener('DOMContentLoaded', async function() {
            await checkAuth();
            initializeForm();
            
            // إضافة محرك افتراضي
            addEngineRow();
        });

        async function checkAuth() {
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error || !session) {
                    window.location.href = 'ship-owner-login.html';
                    return;
                }
                
                const { data: user, error: userError } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', session.user.id)
                    .single();
                
                if (userError || !user) {
                    window.location.href = 'ship-owner-login.html';
                    return;
                }
                
                currentUser = user;
                document.getElementById('ownerName').textContent = user.full_name;
                
            } catch (error) {
                console.error('خطأ في التحقق من الجلسة:', error);
                window.location.href = 'ship-owner-login.html';
            }
        }

        function initializeForm() {
            // التحقق من وجود معرف للتعديل
            const urlParams = new URLSearchParams(window.location.search);
            const editId = urlParams.get('edit');
            
            if (editId) {
                loadApplicationForEdit(editId);
            }
        }

        // ================================================
        // إدارة الخطوات
        // ================================================
        function nextStep(stepNumber) {
            // التحقق من صحة البيانات قبل الانتقال
            if (stepNumber === 2 && !validateStep1()) {
                showToast('يرجى إكمال جميع الحقول المطلوبة في معلومات السفينة', 'error');
                return;
            }
            
            if (stepNumber === 3 && !validateStep2()) {
                showToast('يرجى إضافة محرك واحد على الأقل', 'error');
                return;
            }
            
            if (stepNumber === 4 && !validateStep3()) {
                showToast('يرجى رفع جميع المستندات المطلوبة', 'error');
                return;
            }
            
            // إخفاء جميع الخطوات
            document.getElementById('step1Section').style.display = 'none';
            document.getElementById('step2Section').style.display = 'none';
            document.getElementById('step3Section').style.display = 'none';
            document.getElementById('step4Section').style.display = 'none';
            
            // إظهار الخطوة المطلوبة
            document.getElementById(`step${stepNumber}Section`).style.display = 'block';
            
            // تحديث شريط التقدم
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                if (i < stepNumber) {
                    step.className = 'step completed';
                } else if (i === stepNumber) {
                    step.className = 'step active';
                } else {
                    step.className = 'step';
                }
            }
            
            // إذا كانت الخطوة الرابعة، قم بتحديث صفحة المراجعة
            if (stepNumber === 4) {
                updateReviewPage();
            }
        }

        function prevStep(stepNumber) {
            // إخفاء جميع الخطوات
            document.getElementById('step1Section').style.display = 'none';
            document.getElementById('step2Section').style.display = 'none';
            document.getElementById('step3Section').style.display = 'none';
            document.getElementById('step4Section').style.display = 'none';
            
            // إظهار الخطوة المطلوبة
            document.getElementById(`step${stepNumber}Section`).style.display = 'block';
            
            // تحديث شريط التقدم
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                if (i < stepNumber) {
                    step.className = 'step completed';
                } else if (i === stepNumber) {
                    step.className = 'step active';
                } else {
                    step.className = 'step';
                }
            }
        }

        // ================================================
        // التحقق من صحة البيانات
        // ================================================
        function validateStep1() {
            const requiredFields = [
                'shipNameAr',
                'shipType',
                'portOfRegistry',
                'grossTonnage',
                'netTonnage',
                'lengthOverall',
                'beam',
                'depth',
                'yearBuilt'
            ];
            
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });
            
            return isValid;
        }

        function validateStep2() {
            return engines.length > 0;
        }

        function validateStep3() {
            const requiredDocs = [
                'ownershipDoc',
                'measurementDoc',
                'inspectionDoc',
                'ownerIdDoc'
            ];
            
            let isValid = true;
            
            requiredDocs.forEach(docId => {
                if (!uploadedFiles[docId]) {
                    isValid = false;
                }
            });
            
            return isValid;
        }

        // ================================================
        // إدارة المحركات
        // ================================================
        function addEngineRow() {
            const tbody = document.getElementById('enginesBody');
            const rowCount = engines.length + 1;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" class="form-control" id="engineNumber${rowCount}" placeholder="رقم المحرك"></td>
                <td>
                    <select class="form-control" id="engineType${rowCount}">
                        <option value="main">رئيسي</option>
                        <option value="auxiliary">مساعد</option>
                        <option value="generator">مولد</option>
                    </select>
                </td>
                <td><input type="text" class="form-control" id="engineManufacturer${rowCount}" placeholder="الصانع"></td>
                <td><input type="text" class="form-control" id="engineModel${rowCount}" placeholder="الموديل"></td>
                <td><input type="number" class="form-control" id="enginePower${rowCount}" placeholder="القوة"></td>
                <td><input type="number" class="form-control" id="engineYear${rowCount}" placeholder="سنة الصنع"></td>
                <td><input type="number" class="form-control" id="engineCylinders${rowCount}" placeholder="عدد الأسطوانات"></td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeEngineRow(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            tbody.appendChild(row);
            
            engines.push({
                row: rowCount,
                number: `engineNumber${rowCount}`,
                type: `engineType${rowCount}`,
                manufacturer: `engineManufacturer${rowCount}`,
                model: `engineModel${rowCount}`,
                power: `enginePower${rowCount}`,
                year: `engineYear${rowCount}`,
                cylinders: `engineCylinders${rowCount}`
            });
            
            updateTotalPower();
        }

        function removeEngineRow(button) {
            const row = button.closest('tr');
            const index = Array.from(row.parentNode.children).indexOf(row);
            
            row.remove();
            engines.splice(index, 1);
            
            updateTotalPower();
        }

        function updateTotalPower() {
            let total = 0;
            
            engines.forEach(engine => {
                const powerInput = document.getElementById(engine.power);
                if (powerInput && powerInput.value) {
                    total += parseFloat(powerInput.value) || 0;
                }
            });
            
            document.getElementById('totalEnginePower').value = total;
        }

        // ================================================
        // رفع الملفات
        // ================================================
        function setupFileUpload(inputId, listId) {
            const input = document.getElementById(inputId);
            
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    uploadedFiles[inputId] = file;
                    
                    const list = document.getElementById(listId);
                    list.innerHTML = `
                        <div class="file-item">
                            <div class="file-info">
                                <i class="fas fa-file-${file.type.includes('pdf') ? 'pdf' : 'image'}"></i>
                                <span>${file.name}</span>
                                <span style="color: #64748b; font-size: 0.85rem;">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                            </div>
                            <div class="file-remove" onclick="removeFile('${inputId}', '${listId}')">
                                <i class="fas fa-times"></i>
                            </div>
                        </div>
                    `;
                }
            });
        }

        function removeFile(inputId, listId) {
            delete uploadedFiles[inputId];
            document.getElementById(inputId).value = '';
            document.getElementById(listId).innerHTML = '';
        }

        // ================================================
        // مراجعة البيانات
        // ================================================
        function updateReviewPage() {
            // مراجعة معلومات السفينة
            const shipInfo = document.getElementById('reviewShipInfo');
            shipInfo.innerHTML = `
                <span class="info-label">اسم السفينة:</span>
                <span class="info-value">${document.getElementById('shipNameAr').value || '---'}</span>
                
                <span class="info-label">النوع:</span>
                <span class="info-value">${getShipTypeText(document.getElementById('shipType').value)}</span>
                
                <span class="info-label">ميناء التسجيل:</span>
                <span class="info-value">${getPortName(document.getElementById('portOfRegistry').value)}</span>
                
                <span class="info-label">الحمولة الإجمالية:</span>
                <span class="info-value">${document.getElementById('grossTonnage').value || '---'} طن</span>
                
                <span class="info-label">الحمولة الصافية:</span>
                <span class="info-value">${document.getElementById('netTonnage').value || '---'} طن</span>
                
                <span class="info-label">الطول:</span>
                <span class="info-value">${document.getElementById('lengthOverall').value || '---'} م</span>
                
                <span class="info-label">العرض:</span>
                <span class="info-value">${document.getElementById('beam').value || '---'} م</span>
                
                <span class="info-label">العمق:</span>
                <span class="info-value">${document.getElementById('depth').value || '---'} م</span>
                
                <span class="info-label">سنة الصنع:</span>
                <span class="info-value">${document.getElementById('yearBuilt').value || '---'}</span>
            `;
            
            // مراجعة المحركات
            const enginesInfo = document.getElementById('reviewEnginesInfo');
            if (engines.length === 0) {
                enginesInfo.innerHTML = '<p style="color: #64748b;">لا توجد محركات مسجلة</p>';
            } else {
                let html = '<table style="width: 100%;">';
                html += '<tr><th>رقم المحرك</th><th>النوع</th><th>القوة</th></tr>';
                
                engines.forEach(engine => {
                    html += `
                        <tr>
                            <td>${document.getElementById(engine.number)?.value || '---'}</td>
                            <td>${getEngineTypeText(document.getElementById(engine.type)?.value)}</td>
                            <td>${document.getElementById(engine.power)?.value || '---'} حصان</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                enginesInfo.innerHTML = html;
            }
            
            // مراجعة المستندات
            const docsInfo = document.getElementById('reviewDocumentsInfo');
            let docsHtml = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            
            const docLabels = {
                'ownershipDoc': 'وثيقة الملكية',
                'measurementDoc': 'شهادة القياس',
                'inspectionDoc': 'شهادة الفحص',
                'ownerIdDoc': 'هوية المالك',
                'commercialRegDoc': 'السجل التجاري'
            };
            
            Object.keys(docLabels).forEach(docId => {
                const status = uploadedFiles[docId] ? '✅ تم الرفع' : '❌ لم يتم الرفع';
                const required = ['ownershipDoc', 'measurementDoc', 'inspectionDoc', 'ownerIdDoc'].includes(docId);
                
                docsHtml += `
                    <div style="display: flex; justify-content: space-between;">
                        <span>${docLabels[docId]} ${required ? '*' : ''}</span>
                        <span style="color: ${uploadedFiles[docId] ? 'var(--success)' : 'var(--danger)'};">${status}</span>
                    </div>
                `;
            });
            
            docsHtml += '</div>';
            docsInfo.innerHTML = docsHtml;
        }

        // ================================================
        // تقديم الطلب
        // ================================================
        async function submitApplication() {
            if (!document.getElementById('declarationCheckbox').checked) {
                showToast('يجب الموافقة على الإقرار والتعهد', 'warning');
                return;
            }
            
            // إظهار التحميل
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('registrationContent').style.opacity = '0.5';
            document.getElementById('submitBtn').disabled = true;
            
            try {
                // 1. حفظ معلومات السفينة
                const shipData = {
                    owner_id: currentUser.id,
                    ship_name_ar: document.getElementById('shipNameAr').value,
                    ship_name_en: document.getElementById('shipNameEn').value || null,
                    imo_number: document.getElementById('imoNumber').value || null,
                    call_sign: document.getElementById('callSign').value || null,
                    mmsi: document.getElementById('mmsi').value || null,
                    ship_type: document.getElementById('shipType').value,
                    ship_category: document.getElementById('shipCategory').value || null,
                    port_of_registry: document.getElementById('portOfRegistry').value,
                    flag_state: document.getElementById('flagState').value || 'اليمن',
                    nationality: document.getElementById('nationality').value || 'يمني',
                    gross_tonnage: parseFloat(document.getElementById('grossTonnage').value),
                    net_tonnage: parseFloat(document.getElementById('netTonnage').value),
                    deadweight: parseFloat(document.getElementById('deadweight').value) || null,
                    length_overall: parseFloat(document.getElementById('lengthOverall').value),
                    beam: parseFloat(document.getElementById('beam').value),
                    depth: parseFloat(document.getElementById('depth').value),
                    draft: parseFloat(document.getElementById('draft').value) || null,
                    speed: parseFloat(document.getElementById('speed').value) || null,
                    container_capacity: parseInt(document.getElementById('containerCapacity').value) || null,
                    passenger_capacity: parseInt(document.getElementById('passengerCapacity').value) || null,
                    crew_capacity: parseInt(document.getElementById('crewCapacity').value) || null,
                    year_built: parseInt(document.getElementById('yearBuilt').value),
                    builder_name: document.getElementById('builderName').value || null,
                    building_country: document.getElementById('buildingCountry').value || null,
                    shipyard: document.getElementById('shipyard').value || null,
                    hull_number: document.getElementById('hullNumber').value || null,
                    hull_material: document.getElementById('hullMaterial').value || null,
                    status: 'pending',
                    registration_date: new Date().toISOString().split('T')[0],
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                const { data: ship, error: shipError } = await supabase
                    .from('ships')
                    .insert(shipData)
                    .select()
                    .single();
                
                if (shipError) throw shipError;
                
                // 2. حفظ معلومات المحركات
                if (engines.length > 0) {
                    const enginesData = [];
                    
                    engines.forEach(engine => {
                        enginesData.push({
                            ship_id: ship.id,
                            engine_number: document.getElementById(engine.number)?.value || null,
                            engine_type: document.getElementById(engine.type)?.value || 'main',
                            engine_manufacturer: document.getElementById(engine.manufacturer)?.value || null,
                            engine_model: document.getElementById(engine.model)?.value || null,
                            engine_power: parseFloat(document.getElementById(engine.power)?.value) || null,
                            engine_power_unit: 'hp',
                            engine_year: parseInt(document.getElementById(engine.year)?.value) || null,
                            cylinder_count: parseInt(document.getElementById(engine.cylinders)?.value) || null,
                            created_at: new Date().toISOString()
                        });
                    });
                    
                    const { error: enginesError } = await supabase
                        .from('ship_engines')
                        .insert(enginesData);
                    
                    if (enginesError) throw enginesError;
                }
                
                // 3. رفع المستندات إلى Supabase Storage
                const documents = [];
                
                for (const [docId, file] of Object.entries(uploadedFiles)) {
                    const fileName = `${ship.id}/${docId}_${Date.now()}_${file.name}`;
                    
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('ship-documents')
                        .upload(fileName, file);
                    
                    if (uploadError) throw uploadError;
                    
                    const { data: { publicUrl } } = supabase.storage
                        .from('ship-documents')
                        .getPublicUrl(fileName);
                    
                    documents.push({
                        ship_id: ship.id,
                        application_id: null, // سيتم تحديثه لاحقاً
                        document_type: docId.replace('Doc', ''),
                        document_number: null,
                        file_url: publicUrl,
                        issue_date: null,
                        expiry_date: null,
                        issuing_authority: null,
                        verification_status: 'pending',
                        uploaded_by: currentUser.id,
                        uploaded_at: new Date().toISOString()
                    });
                }
                
                if (documents.length > 0) {
                    const { error: docsError } = await supabase
                        .from('ship_documents')
                        .insert(documents);
                    
                    if (docsError) throw docsError;
                }
                
                // 4. إنشاء طلب التسجيل
                const applicationNumber = `REG-${new Date().getFullYear()}-${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`;
                
                const applicationData = {
                    owner_id: currentUser.id,
                    ship_id: ship.id,
                    application_type: 'new',
                    application_number: applicationNumber,
                    branch: document.getElementById('portOfRegistry').value,
                    status: 'pending',
                    submission_date: new Date().toISOString().split('T')[0],
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                const { data: application, error: appError } = await supabase
                    .from('applications')
                    .insert(applicationData)
                    .select()
                    .single();
                
                if (appError) throw appError;
                
                // 5. تحديث معرف الطلب في المستندات
                if (documents.length > 0) {
                    await supabase
                        .from('ship_documents')
                        .update({ application_id: application.id })
                        .eq('ship_id', ship.id);
                }
                
                // 6. إنشاء إشعار للمالك
                await supabase
                    .from('notifications')
                    .insert({
                        user_id: currentUser.id,
                        title: 'تم استلام طلب التسجيل',
                        message: `تم استلام طلب تسجيل السفينة ${ship.ship_name_ar} بنجاح، رقم الطلب: ${applicationNumber}`,
                        type: 'success',
                        link: `/application-details.html?id=${application.id}`,
                        created_at: new Date().toISOString()
                    });
                
                showToast('تم تقديم الطلب بنجاح', 'success');
                
                // الانتقال إلى صفحة تفاصيل الطلب
                setTimeout(() => {
                    window.location.href = `application-details.html?id=${application.id}`;
                }, 2000);
                
            } catch (error) {
                console.error('خطأ في تقديم الطلب:', error);
                showToast('فشل تقديم الطلب: ' + error.message, 'error');
                
                // إخفاء التحميل
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('registrationContent').style.opacity = '1';
                document.getElementById('submitBtn').disabled = false;
            }
        }

        // ================================================
        // دوال مساعدة
        // ================================================
        function getShipTypeText(type) {
            const types = {
                'cargo': 'سفينة شحن',
                'tanker': 'ناقلة نفط',
                'container': 'سفينة حاويات',
                'passenger': 'سفينة ركاب',
                'fishing': 'سفينة صيد',
                'tug': 'قاطرة',
                'yacht': 'يخت',
                'dredger': 'كراكة',
                'research': 'سفينة أبحاث',
                'supply': 'سفينة إمداد',
                'other': 'أخرى'
            };
            return types[type] || type;
        }

        function getPortName(port) {
            const ports = {
                'aden': 'عدن',
                'mukalla': 'المكلا',
                'hodeidah': 'الحديدة',
                'salif': 'الصليف',
                'mocha': 'المخا',
                'socotra': 'سقطرى'
            };
            return ports[port] || port;
        }

        function getEngineTypeText(type) {
            const types = {
                'main': 'رئيسي',
                'auxiliary': 'مساعد',
                'generator': 'مولد'
            };
            return types[type] || type;
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        async function logout() {
            await supabase.auth.signOut();
            window.location.href = 'ship-owner-login.html';
        }

        // تهيئة رفع الملفات
        setupFileUpload('ownershipDoc', 'ownershipDocList');
        setupFileUpload('measurementDoc', 'measurementDocList');
        setupFileUpload('inspectionDoc', 'inspectionDocList');
        setupFileUpload('ownerIdDoc', 'ownerIdDocList');
        setupFileUpload('commercialRegDoc', 'commercialRegDocList');

        // الاستماع لتغييرات المحركات لتحديث إجمالي القدرة
        document.addEventListener('input', function(e) {
            if (e.target.id.includes('enginePower')) {
                updateTotalPower();
            }
        });
    </script>
</body>
</html>